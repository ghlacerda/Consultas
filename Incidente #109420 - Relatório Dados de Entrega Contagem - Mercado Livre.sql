--20.121.850/0009-02
--20.121.850/0007-40
--20.121.850/0010-46
--20.121.850/0001-55
--20.121.850/0003-17
--20.121.850/0008-21

SELECT DISTINCT
		FO.NOME
		,NUMEROVIAGEM
		--,D.NUMERO AS NUMERODOCUMENTO
		,V.INICIOEFETIVO
		,COUNT(DISTINCT D.NUMERO) AS QTDDOCS

FROM GLOP_VIAGENS V
	INNER JOIN GLGL_ENUMERACAOITEMS TPV 
		ON TPV.HANDLE = V.TIPOVIAGEM
	INNER JOIN GLOP_VIAGEMDOCUMENTOS DV 
		ON DV.VIAGEM = V.HANDLE
	LEFT JOIN GLGL_DOCUMENTOS D 
		ON DV.DOCUMENTOLOGISTICA = D.HANDLE
	JOIN FILIAIS FO 
		ON FO.HANDLE = V.FILIALORIGEM
	JOIN GLGL_FILIAIS FD 
		ON FD.HANDLE = V.FILIALDESTINO
	INNER JOIN GN_PESSOAS GNPR 
		ON D.ORIGEMPESSOA = GNPR.HANDLE 

WHERE 1=1
	AND V.TIPOVIAGEM = 173
	AND V.FILIALORIGEM = 2                                                                                                                                                                                                                                     
	And Convert(Date, v.INICIOEFETIVO) >= @BeginDate
	And Convert(Date, v.INICIOEFETIVO) < @EndDate
	--And V.NUMEROVIAGEM = '2019/346043-2'
	AND GNPR.CGCCPF IN (
						'20.121.850/0009-02'
						,'20.121.850/0007-40'
						,'20.121.850/0010-46'
						,'20.121.850/0001-55'
						,'20.121.850/0003-17'
						,'20.121.850/0008-21'
					   )
	AND ((D.TIPODOCUMENTO				= 2
	AND	 D.TIPODOCUMENTOFRETE = 153)
	OR  (D.TIPODOCUMENTO = 6
	AND  D.TIPORPS IN (322, 902)))

GROUP BY 
		FO.NOME
		,NUMEROVIAGEM
		--,D.NUMERO
		,V.INICIOEFETIVO